var app=app||{};app.main=function(){var t=[],i={},e=function(){app.router.route(),o(),n.load(),l(),a()},n={load:function(){var t=JSON.parse(localStorage.getItem("todo"));null===t?localStorage.setItem("todo","[]"):t.forEach(function(t){new c(t.title,t.fav).create()})},save:function(){var i=[];t.forEach(function(t){i.unshift({title:t.model.item.title,fav:t.model.item.fav})}),localStorage.setItem("todo",JSON.stringify(i))}},o=function(){$(window).on("hashchange",function(){app.router.route(),a()})},a=function(){console.log("attaching events"),$(".page").off("webkitTransitionEnd").on("webkitTransitionEnd",function(){$(this).addClass("end")}),$(".end").off("webkitTransitionEnd").on("webkitTransitionEnd",function(){$(this).remove()}),$("#btnAddPlant").off("click").on("click",function(){app.pages.render.newPlant(),$("#btnOverlayerClose").off("click").on("click",function(){console.log("close overlayer"),$(".overlayer").addClass("slideInFromBottom"),$(".overlayer").off("webkitTransitionEnd").on("webkitTransitionEnd",function(){$(this).remove()})}),$("#itemAddBtn").off("click").on("click",function(){console.log("hiiiiiii"),r(),$(".overlayer").addClass("slideInFromBottom"),$(".overlayer").off("webkitTransitionEnd").on("webkitTransitionEnd",function(){$(this).remove()})})}),$("#btnAddDiary").off("click").on("click",function(){app.pages.render.newDiary(),$("#btnOverlayerClose2").off("click").on("click",function(){console.log("close overlayer"),$(".overlayer").addClass("slideInFromBottom"),$(".overlayer").off("webkitTransitionEnd").on("webkitTransitionEnd",function(){$(this).remove()})})}),$(".testClick").off("click").on("click",function(){console.log("clicked")})},r=function(){var t=$("#itemInput").val();t.length>2?(new c(t,!1).create(),l(),a(),$("#itemInput").val("")):alert("Title invalid")},l=function(){t.forEach(function(t,i){t.model.render(i)})},c=function(e,o){return this.item={title:e,fav:o||!1},this.create=function(){i.model=this,new s(this).create(),n.save()},this.render=function(i){t[i].view.render()},this.update=function(i){this.item.fav=!this.item.fav,t[i].view.update(),n.save()},this},s=function(e){return this.item=null,this.create=function(){var n=$("<div></div>").addClass("item").hide(),o=$('<a href="#/"></a>').addClass("itemTitle");o.attr("href","#/"+e.item.title),o.html(e.item.title),n.append(o),this.item=n,i.view=this,t.unshift(i),i={}},this.render=function(){for(var t=0;t<this.item.length;t++)$("#itemsContainer").append('<div id="item_"'+t+">"+this.model.item[t].title+"</div>")},this.update=function(){this.item.children(".itemFavorite").toggleClass("fav")},this};return{init:e,itmes:t}}(),$(window).on("load",app.main.init);