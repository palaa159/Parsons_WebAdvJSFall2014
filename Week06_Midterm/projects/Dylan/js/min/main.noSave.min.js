var app=app||{};app.main=function(){var t=[],e={},i={x:0,y:0},n=function(){document.addEventListener("mousemove",function(t){i.x=t.clientX||t.pageX,i.y=t.clientY||t.pageY},!1),$(document).off("keypress").on("keypress",function(t){$("#itemInput").focus(),13==t.which&&o()}),$(".itemDelete").off("click").on("click",function(){var e=$(this).parent();t.forEach(function(i,n){i.view.item[0]===e[0]&&t[n].model.remove(n)})}),$(".item").off("dblclick").on("dblclick",function(){var t=$("#itemInput").val();t.length>0&&($(this).append("<br>"+t),console.log(this),$("#itemInput").val(""))})},o=function(){var e=$("#itemInput").val();e.length>0?(new s(e,{x:i.x,y:i.y}).add(),$("#itemInput").val(""),a(),n()):alert("Field empty"),console.log(t)},a=function(){console.info("rendering"),$("#itemsContainer").empty(),t.forEach(function(t,e){t.model.render(e)})},s=function(i,n){this.item={title:i,pos:n,text:[],time:[]},this.add=function(){e.model=this,new p(this).add(),l.save()},this.render=function(e){t[e].view.render(),l.save()},this.update=function(e){this.item.fav=!this.item.fav,t[e].view.update(),l.save()},this.remove=function(e){t[e].view.remove(),t.splice(e,1),l.save()}},p=function(i){this.item=null,this.add=function(){{var n=$("<div></div>").addClass("item").hide().css("position","absolute").css("left",i.item.pos.x).css("top",i.item.pos.y);$("<span>&#127919;</span>").addClass("itemFavorite").appendTo(n),$("<span></span>").addClass("itemTitle").html(i.item.title).appendTo(n),$("<span>&times;</span>").addClass("itemDelete").appendTo(n)}this.item=n,e.view=this,t.unshift(e),e={}},this.update=function(){$("<span><br>hello</span>").appendTo(this.item)},this.render=function(){$("#itemsContainer").append(this.item),this.item.fadeIn()},this.remove=function(){this.item.fadeOut()}},l={load:function(){if(0===localStorage.length){var t=JSON.stringify([]);localStorage.setItem("app",t)}else{var e=JSON.parse(localStorage.getItem("app"));e.forEach(function(t){new s(t.title,t.pos).add()})}},save:function(){var e=[];t.forEach(function(t){e.unshift({title:t.model.item.title,pos:t.model.item.pos})}),localStorage.setItem("app",JSON.stringify(e))}},c=function(){console.info("app init"),l.load(),a(),n()};return{init:c,items:t}}(),$(window).on("load",app.main.init);