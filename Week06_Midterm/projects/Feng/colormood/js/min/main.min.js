var app=app||{};app.main=function(){var e=[],t={},i=0,n=function(){FastClick.attach(document.body),app.router.route(),o(),a(),d.load()},o=function(){$(window).on("hashchange",function(){app.router.route(),a()})},a=function(){console.log("attaching events"),$("#itemAddBtn").off("click").on("click",c),$(".itemFavorite").off("click").on("click",function(){var t=$(this).parent();e.forEach(function(i,n){i.view.item[0]===t[0]&&e[n].model.update(n)})}),$(".itemDelete").off("click").on("click",function(){var t=$(this).parent();e.forEach(function(i,n){i.view.item[0]===t[0]&&e[n].model.remove(n)})}),$("#red").off("click").on("click",function(){i=1,console.log(i)}),$("#blue").off("click").on("click",function(){i=2,console.log(i)}),$("#green").off("click").on("click",function(){i=3,console.log(i)}),$(".page").off("webkitTransitionEnd").one("webkitTransitionEnd",function(){$(this).addClass("end")}),$(".end").off("webkitTransitionEnd").one("webkitTransitionEnd",function(){$(this).remove()}),$("#btnCreate").off("click").on("click",function(){app.pages.render.create(),$("#btnOverlayerClose").off("click").on("click",function(){console.log("close overlayer"),$(this).parent().addClass("slideInFromBottom"),$(".overlayer").off("webkitTransitionEnd").on("webkitTransitionEnd",function(){$(this).remove()})})})},c=function(){var e=$("#itemInput").val();e.length<200?(new l(e,!1,i).add(),$("#itemInput").val(""),s(),a()):alert("200 characters max.")},s=function(){console.info("rendering"),$("#itemsContainer").empty(),e.forEach(function(e,t){e.model.render(t)})},l=function(i,n,o){return this.item={title:i,fav:n,color:o},this.add=function(){t.model=this,new r(this).add(),d.save()},this.render=function(t){e[t].view.render(),d.save()},this.update=function(t){this.item.fav=!this.item.fav,e[t].view.update(),d.save()},this.remove=function(t){e[t].view.remove(),e.splice(t,1),d.save()},this},r=function(i){return this.item=null,this.add=function(){var n,o=$("<div></div>").addClass("item").hide();n=i.item.fav?$("<span>&#10084;</span>").addClass("itemFavorite fav").appendTo(o):$("<span>&#10084;</span>").addClass("itemFavorite").appendTo(o);{var a;$("<span></span>").addClass("itemTitle").html(i.item.title).appendTo(o),$("<span>&times;</span>").addClass("itemDelete").appendTo(o)}1==i.item.color?a=$("<div></div>").addClass("itemRed").appendTo(o):2==i.item.color?a=$("<div></div>").addClass("itemGreen").appendTo(o):3==i.item.color&&(a=$("<div></div>").addClass("itemBlue").appendTo(o)),this.item=o,t.view=this,e.unshift(t),t={}},this.update=function(){this.item.children(".itemFavorite").toggleClass("fav")},this.render=function(){$("#itemsContainer").append(this.item),this.item.fadeIn()},this.remove=function(){this.item.fadeOut()},this},d={load:function(){if(0===localStorage.length){var e=JSON.stringify([]);localStorage.setItem("app",e)}else{var t=JSON.parse(localStorage.getItem("app"));t.forEach(function(e){new l(e.title,e.fav,e.color).add(),console.log("----hi load"+e.color)})}},save:function(){var t=[];e.forEach(function(e){t.unshift({title:e.model.item.title,fav:e.model.item.fav,color:e.model.item.color})}),localStorage.setItem("app",JSON.stringify(t)),console.log(t)}};return{init:n,items:e,storage:d}}(),$(window).on("load",app.main.init);