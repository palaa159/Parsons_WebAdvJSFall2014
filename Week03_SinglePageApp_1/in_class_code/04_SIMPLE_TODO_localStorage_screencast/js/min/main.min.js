var app=app||{};app.main=function(){var t=[],e={},i=function(){console.log("app init"),n.load(),c(),a()},n={load:function(){var t=JSON.parse(localStorage.getItem("todo"));console.log(t),null===t?localStorage.setItem("todo","[]"):t.forEach(function(t){new f(t.title,t.fav).create()})},save:function(){var e=[];t.forEach(function(t){e.unshift({title:t.model.item.title,fav:t.model.item.fav})}),localStorage.setItem("todo",JSON.stringify(e))}},a=function(){$("#itemAddBtn").off("click").on("click",l),$(".itemDelete").off("click").on("click",o),$(".itemFavorite").off("click").on("click",s)},o=function(){var e=$(this).parent();t.forEach(function(i,n){console.log(i.view[0],e[0]),i.view.item[0]===e[0]&&t[n].model.delete(n)})},s=function(){var e=$(this).parent();t.forEach(function(i,n){i.view.item[0]===e[0]&&t[n].model.update(n)})},l=function(){var t=$("#itemInput").val();t.length>2?(new f(t,!1).create(),c(),a(),$("#itemInput").val("")):alert("Title invalid")},c=function(){t.forEach(function(t,e){t.model.render(e)})},f=function(i,a){return this.item={title:i,fav:a||!1},this.create=function(){e.model=this,new r(this).create(),n.save()},this.render=function(e){t[e].view.render()},this.update=function(e){this.item.fav=!this.item.fav,t[e].view.update(),n.save()},this.delete=function(e){console.log("deleting"),t[e].view.delete(),t.splice(e,1),n.save()},this},r=function(i){return this.item=null,this.create=function(){var n=$("<div></div>").addClass("item").hide();if(i.item.fav)var a=$("<span>&#10084;</span>").addClass("itemFavorite fav");else var a=$("<span>&#10084;</span>").addClass("itemFavorite");var o=$("<span>&times;</span>").addClass("itemDelete"),s=$("<span></span>").addClass("itemTitle");s.html(i.item.title),n.append(a),n.append(s),n.append(o),this.item=n,e.view=this,t.unshift(e),e={}},this.render=function(){$("#itemsContainer").append(this.item),this.item.fadeIn()},this.update=function(){this.item.children(".itemFavorite").toggleClass("fav")},this.delete=function(){this.item.fadeOut()},this};return{init:i,items:t}}(),$(document).ready(app.main.init);